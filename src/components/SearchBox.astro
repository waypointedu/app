---
const { minimal = false } = Astro.props as { minimal?: boolean };
---
<div
  class:list={[
    'relative',
    minimal ? 'w-full max-w-[280px]' : 'w-full'
  ]}
  x-data="searchBox()"
>
  <input
    type="search"
    class:list={[
      'search-field',
      minimal ? 'search-field--inverse pr-20' : 'pr-24 shadow-sm'
    ]}
    placeholder="Search the library"
    x-model="query"
    @keydown.enter="go()"
    aria-label="Search the library"
  />
  <button
    type="button"
    class="search-submit"
    @click="go()"
    aria-label="Run search"
  >
    Search
  </button>
</div>
<script type="module">
  const searchBox = () => ({
    query: new URL(window.location.href).searchParams.get('q') ?? '',
    go() {
      const url = new URL('/search', window.location.origin);
      if (this.query) url.searchParams.set('q', this.query);
      window.location.href = url.toString();
    }
  });
</script>
