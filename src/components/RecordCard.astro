---
const {
  title,
  creators = [],
  year,
  subjects = [],
  collection,
  quality,
  coverUrl,
  permalink
} = Astro.props as Record<string, any>;

const normalizedPermalink = permalink?.startsWith('/') ? permalink : `/${permalink ?? ''}`;
const headingId = `record-card-${(normalizedPermalink ?? title ?? 'card').replace(/[^a-z0-9]+/gi, '-').toLowerCase()}`;
---
<article class="card linked" data-kind="record-card">
  <a class="stretched" href={normalizedPermalink} aria-labelledby={headingId} aria-describedby={headingId + '-meta'}></a>
  <div class="card__body flex flex-col gap-4">
    <div class="overflow-hidden rounded-xl border" style="border-color:var(--line); background:var(--panel)">
      <div class="aspect-[3/4] w-full overflow-hidden">
        {coverUrl ? (
          <img
            src={coverUrl}
            alt={`Cover of ${title}`}
            loading="lazy"
            decoding="async"
            class="h-full w-full object-cover transition-transform duration-300"
          />
        ) : (
          <div
            class="flex h-full w-full items-center justify-center text-sm font-semibold uppercase tracking-widest"
            style="background: var(--brand-100); color: var(--brand-600)"
          >
            {title?.slice(0, 1)}
          </div>
        )}
      </div>
    </div>
    <div class="space-y-2">
      <h3 id={headingId} class="text-xl font-semibold leading-tight">
        {title}
      </h3>
      {creators.length ? <p class="card__meta">{creators.join(', ')}</p> : null}
      <p id={headingId + '-meta'} class="card__meta text-sm uppercase tracking-[0.2em]">
        {collection} · {year}
      </p>
      {subjects.length ? (
        <div class="card__tags" role="list">
          {subjects.slice(0, 3).map((subject) => (
            <span role="listitem" class="chip">
              {subject}
            </span>
          ))}
        </div>
      ) : null}
    </div>
  </div>
  <footer class="card__footer mt-auto flex items-center justify-between gap-3">
    <div>
      {quality ? (
        <span class="chip" aria-label={`Quality grade ${quality}`}>
          Quality {quality}
        </span>
      ) : null}
    </div>
    <span class="card__cta" aria-hidden="true">
      Open record →
    </span>
  </footer>
</article>
